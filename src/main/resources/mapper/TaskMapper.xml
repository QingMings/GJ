<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yhl.gj.mapper.TaskMapper">
    <resultMap id="BaseResultMap" type="com.yhl.gj.model.Task">
        <!--@mbg.generated-->
        <!--@Table HZGJ.GJ_TASK-->
        <id column="ID" jdbcType="BIGINT" property="id"/>
        <result column="TASK_NAME" jdbcType="VARCHAR" property="taskName"/>
        <result column="ORDER_PATH" jdbcType="LONGVARCHAR" property="orderPath"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>
        <result column="CUR_WARN_LEVEL" jdbcType="INTEGER" property="curWarnLevel"/>
        <result column="MAX_WARN_LEVEL" jdbcType="INTEGER" property="maxWarnLevel"/>
        <result column="CHECKED_DETAIL_ID" jdbcType="BIGINT" property="checkedDetailId"/>
        <result column="TASK_STATUS" jdbcType="INTEGER" property="taskStatus"/>
    </resultMap>
    <resultMap id="BaseResultMapForTaskVO" type="com.yhl.gj.vo.TaskVO">
        <!--@mbg.generated-->
        <!--@Table SYSDBA.GJ_TASK-->
        <id column="ID" jdbcType="BIGINT" property="id"/>
        <result column="TASK_NAME" jdbcType="VARCHAR" property="taskName"/>
        <result column="ORDER_PATH" jdbcType="LONGVARCHAR" property="orderPath"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>
        <result column="CUR_WARN_LEVEL" jdbcType="INTEGER" property="curWarnLevel"/>
        <result column="MAX_WARN_LEVEL" jdbcType="INTEGER" property="maxWarnLevel"/>
        <result column="CHECKED_DETAIL_ID" jdbcType="BIGINT" property="checkedDetailId"/>
        <result column="TASK_STATUS" jdbcType="INTEGER" property="taskStatus"/>
        <result column="LAST_DETAIL_ID" jdbcType="BIGINT" property="lastDetailId"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--@mbg.generated-->
        ID,
        TASK_NAME,
        ORDER_PATH,
        CREATE_DATE,
        UPDATE_DATE,
        CUR_WARN_LEVEL,
        MAX_WARN_LEVEL,
        CHECKED_DETAIL_ID,
        TASK_STATUS
    </sql>


    <select id="queryTaskByCondition" resultMap="BaseResultMapForTaskVO">
        select
        <include refid="Base_Column_List"/>
        from HZGJ.GJ_TASK GT
        <where>
            <if test="param.startTime != null">
                and GT.CREATE_DATE &gt;= to_date(#{param.startTime,jdbcType=TIMESTAMP}, 'yyyy-mm-dd hh24:mi:ss')
            </if>
            <if test="param.endTime != null">
                and GT.CREATE_DATE &lt;= to_date(#{param.endTime,jdbcType=TIMESTAMP}, 'yyyy-mm-dd hh24:mi:ss')
            </if>
            <if test="param.currentWarnLevel != null  and param.currentWarnLevel.size() > 0">
                and  (<foreach collection="param.currentWarnLevel" index="index" item="item" separator="or">
                GT.CUR_WARN_LEVEL = #{item,jdbcType=VARCHAR}
            </foreach>)
            </if>
            <if test="param.maxWarnLevel != null  and param.maxWarnLevel.size() > 0">
                and  (<foreach collection="param.maxWarnLevel" index="index" item="item" separator="or">
                GT.MAX_WARN_LEVEL = #{item,jdbcType=VARCHAR}
            </foreach>)
            </if>
            <if test="param.taskNames != null  and param.taskNames.size()>0">
                and GT.TASK_NAME IN <foreach collection="param.taskNames" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
            </if>
        </where>
        order by GT.CREATE_DATE desc
    </select>

    <select id="queryRunningTasks" resultMap="BaseResultMap">
        select
            <include refid="Base_Column_List"/>
        from HZGJ.GJ_TASK
        where TASK_STATUS = 1
    </select>

    <select id="finishedTask" resultType="java.lang.Integer">
        update HZGJ.GJ_TASK set TASK_STATUS = 0 where id = #{id}
    </select>
</mapper>